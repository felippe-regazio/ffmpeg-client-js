"use strict";function send(e,r){return postMessage({payload:r,type:e.toLowerCase()})}function parseArgs(e){var n=[];return(e=e.replace(/\s+/g," ")).split('"').forEach(function(e,r){e=e.trim(),r%2==1?n.push(e):n=n.concat(e.split(" "))}),n}function parseFile(e){var r={};return e instanceof Uint8Array&&(r=e),e instanceof File&&(r=fileToUint8Array(e)),{name:e.name,data:r}}function fileToUint8Array(e){return new Uint8Array((new FileReaderSync).readAsArrayBuffer(e))}function execute(e){send("busy",{});var r=e.files,s=e.args,o=[],a="",i=[];if(!r||!r.length)return send("error",{error:'The "files" payload is empty, there is nothing to process',stdout:""});Array.from(r).forEach(function(e){var r=parseFile(e),n=parseArgs(s.replace(/\{\{file\}\}/g,e.name)),t=ffmpeg_run({stdin:function(){},files:[r],arguments:n,print:function(e){return a+="\n"+e},printErr:function(e){return a+="\n"+e},onExit:function(e){e={error:e,stdout:a};return i.push(e),send("error",e),!1}});if(!t||!t.length){e={error:('The ffmpeg exec returned an empty result for file "'+r.name+'". This may be caused by a runtime error,\n\t\t\ta bad input, corrupted file, wrong or no arguments, or bad network connection. See the stdout for details.').replace(/\s\s+/g," "),stdout:a};return i.push(e),send("error",e),!1}o.push({buffers:t,name:r.name,args:n.join(" "),blobs:t.map(function(e){return new Blob([e.data])})})}),i.length||postMessage({result:o,stdout:a,type:"done"})}send("loading",{}),importScripts("./ffmpeg-wasm.js"),self.onmessage=function(e){return execute(e.data)},self.onerror=function(e){return send("error",e)},self.onmessageerror=function(e){return send("error",e)},send("ready",{});